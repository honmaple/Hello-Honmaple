<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Realtime Markdown Viewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/markdown.css" type="text/css" />
    <script src="http://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/marked/0.3.6/marked.min.js"></script>
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript">
     $(function() {
         var ws = new WebSocket('ws://localhost:8080');
         ws.onopen = function () {
             ws.send("I'm connected");
         };
         ws.onclose = function (event) {
             window.open('', '_self', '');
             window.close();
         };
         ws.onmessage = function (event) {
             marked.setOptions({
                 highlight: function(code) {
                     return hljs.highlightAuto(code).value;
                 }
             })
             $("#preview").html(marked(event.data))
             var scroll = $(document).height() * ($("#position-percentage").html() / 100);
             $("html, body").animate({ scrollTop: scroll }, 300);
         };
         ws.onerror = function (event) {
             console.log(event);
         };
     });
    </script>
  </head>
  <body>
    <div class="container">
      <div id="preview">Markdown Preview</div>
    </div>
  </body>
</html>
